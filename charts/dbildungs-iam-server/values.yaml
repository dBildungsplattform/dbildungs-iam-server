nameOverride: ''
fullnameOverride: ''
namespaceOverride: ''

backendHostname: ''
keycloakHostname: ''

containerSecurityContext:
  enabled: true
  runAsUser: 1000
  runAsNonRoot: true
  privileged: false
  readOnlyRootFilesystem: false
  allowPrivilegeEscalation: false
  capabilities:
    drop: ['ALL']
  seccompProfile:
    type: 'RuntimeDefault'

restartPolicy: Always
environment: dev

database:
  name: 'dbildungs_iam_server'
  host: ''
  password: ''
  username: 'dbildungs_iam_server'

ldap:
  url: ldap://dbildungs-iam-ldap.spsh-xxx.svc.cluster.local

itslearning:
  enabled: false
  endpoint: https://enterprise.itslintegrations.com/WCFServiceLibrary/ImsEnterpriseServicesPort.svc

privacyidea:
  url: https://privacyidea.dev.spsh.dbildungsplattform.de
  renameWaitingTime: 5
  realm: ucs_users
  userResolver: ucs_users

auth:
  # existingSecret: Refers to a secret already present in the cluster, which is required.
  existingSecret: ''
  secretName: dbildungs-iam-server
  keycloak_adminSecret: ''
  keycloak_clientSecret: ''
  ldap_bind_dn: ''
  ldap_admin_password: ''
  secrets_json: ''
  frontend_sessionSecret: ''
  itslearning_username: ''
  itslearning_password: ''
  pi_admin_user: ''
  pi_admin_password: ''
  redis_password: ''

backend:
  replicaCount: 1
  image:
    repository: ghcr.io/dbildungsplattform/dbildungs-iam-server
    tag: ''
    pullPolicy: Always
  containerPorts:
    http: 8080
  resources:
    limits:
      cpu: 2
      memory: 4G
    requests:
      cpu: 200m
      memory: 200Mi
  startupProbe:
    enabled: true
    initialDelaySeconds: 60
    periodSeconds: 60
    failureThreshold: 5
    httpGet:
      scheme: 'HTTP'
      port: 8080
      path: '/health'
  livenessProbe:
    enabled: true
    initialDelaySeconds: 10
    httpGet:
      scheme: 'HTTP'
      port: 8080
      path: '/health'
  readinessProbe:
    enabled: true
    initialDelaySeconds: 10
    httpGet:
      scheme: 'HTTP'
      port: 8080
      path: '/health'
  dbseeding:
    enabled: true
    command: [ "node", "dist/src/console/main.js", "db", "seed", "dev" ]
  dbmigration:
    enabled: true
    command: [ "node", "dist/src/console/main.js", "db", "migration-apply" ]
  keycloakdatamigration: 
    enabled: true
    command: [ "node", "dist/src/console/main.js", "keycloak", "update-clients", "dev" ]
  ingress:
    enabled: true
    ingressClassName: nginx
    pathType: Prefix
    portnumber: 80
    automountServiceAccountToken: false
    paths:
      - /api
      - /docs
      - /docs-json
      - /docs-yaml
    annotations: []
  service:
    type: ClusterIP
    ports:
      http: 80
  serviceMonitor:
    enabled: true
    endpoints:
      - port: 'web'
  extraEnvVars: []
  extraVolumes: []
  volumeMounts:
    - mountPath: /app/config/config.json
      subPath: config-json
      name: config-volume
      readOnly: true
    - mountPath: /app/config/secrets.json
      subPath: secrets-json
      name: secret-volume
  extraVolumeMounts: []


# Reference: https://github.com/bitnami/charts/tree/main/bitnami/redis-cluster
redis-cluster:
  enabled: true
  persistence: 
    enabled: false
    size: 4Gi
  image:
    registry: docker.io
    repository: bitnami/redis-cluster
    tag: 7.4
  existingSecret: dbildungs-iam-server-redis
  cluster:
      ## This is total number of nodes including the replicas. Meaning there will be 3 master and 3 replica
      ## nodes (as replica count is set to 1 by default, there will be 1 replica per master node).
      ## Hence, nodes = numberOfMasterNodes + numberOfMasterNodes * replicas
      ## The number of master nodes should always be >= 3, otherwise cluster creation will fail
      nodes: 6
      # for staging and prod this could get increased
      ## @param cluster.replicas Number of replicas for every master in the cluster
      replicas: 1
  networkPolicy:
    enabled: false
  pdb:
    create: false
  serviceAccount:
    create: false
  usePassword: true
  tls:
    enabled: false
  podLabels:
      app.kubernetes.io/component: server-redis
  commonLabels:
    app.kubernetes.io/name: dbildungs-iam-server 
  resources:
    limits:
      cpu: 300m
      memory: 512Mi
    requests:
      cpu: 125m
      memory: 128Mi
  metrics:
    enabled: true
   
autoscaling:
  enabled: false
  minReplicas: 1
  maxReplicas: 5
  targetCPUUtilizationPercentage: 60